<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register</title>

    <!-- Tailwind + fonts -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

    <script id="tailwind-config">
        tailwind.config = {
          darkMode: "class",
          theme: {
            extend: {
              colors: {
                "primary": "#17cf17",
                "background-light": "#f6f8f6",
                "background-dark": "#112111",
              },
              fontFamily: { "display": ["Manrope", "sans-serif"] },
              borderRadius: { "DEFAULT":"0.25rem","lg":"0.5rem","xl":"0.75rem","full":"9999px" },
            },
          },
        }
    </script>
    <style>
        .material-symbols-outlined {
          font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 24;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-[#0e1b0e] dark:text-white">
<div class="relative flex min-h-screen w-full flex-col overflow-x-hidden">

    <!-- Top bar -->
    <header class="flex items-center justify-between border-b border-b-[#e7f3e7] dark:border-b-white/10 px-6 md:px-10 py-3">
        <div class="flex items-center gap-3">
            <div class="size-6 text-[#0e1b0e] dark:text-white">
                <svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                    <path d="M24 4C25.7818 14.2173 33.7827 22.2182 44 24C33.7827 25.7818 25.7818 33.7827 24 44C22.2182 33.7827 14.2173 25.7818 4 24C14.2173 22.2182 22.2182 14.2173 24 4Z" fill="currentColor"/>
                </svg>
            </div>
            <h1 class="text-lg font-bold tracking-[-0.015em]">PropertEase</h1>
        </div>
    </header>

    <!-- Main -->
    <main class="flex flex-1 justify-center py-10 px-4 sm:px-6 lg:px-8">
        <div class="w-full max-w-3xl">
            <!-- Title -->
            <div class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-extrabold leading-tight tracking-[-0.03em]">Create your account</h1>
                <p class="text-[#4e974e] dark:text-primary/70 text-base mt-2">Role:
                    <strong class="font-semibold" th:text="${role}">buyer</strong>
                </p>
            </div>

            <!-- FORM -->
            <form th:action="@{|/register/${role}|}" th:object="${user}" method="post" class="space-y-6">
                <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                <!-- Hidden role field -->
                <input type="hidden" th:field="*{role}" th:value="${role}"/>
                <small class="text-red-600 mt-1 block"
                       th:if="${#fields.hasErrors('role')}"
                       th:errors="*{role}">Role error</small>

                <!-- Phones block -->
                <div class="rounded-xl border border-[#d0e7d0] dark:border-white/10 bg-white dark:bg-background-dark/40 p-4"
                     id="phones"
                     th:attr="data-next-index=${#lists.size(user.phones)}">
                    <label class="block text-base font-medium mb-2">Phone numbers</label>

                    <div class="space-y-3">
                        <div class="flex items-center gap-2" th:each="p, iStat : *{phones}">
                            <input th:field="*{phones[__${iStat.index}__].phoneNumber}"
                                   type="tel"
                                   placeholder="+94 7X XXX XXXX"
                                   class="form-input flex-1 rounded-lg border-[#d0e7d0] dark:border-white/20 bg-background-light dark:bg-background-dark h-12 px-4 text-base placeholder:text-[#4e974e] dark:placeholder:text-white/40 focus:border-primary focus:ring-primary"/>
                            <button type="button"
                                    class="px-3 h-12 rounded-lg border border-[#d0e7d0] dark:border-white/20 text-[#0e1b0e] dark:text-white hover:bg-primary/10"
                                    th:if="${iStat.index > 0}"
                                    onclick="this.parentElement.remove()">Remove</button>
                        </div>
                    </div>

                    <button id="addPhone" type="button"
                            class="mt-3 inline-flex items-center gap-2 rounded-lg border border-dashed border-[#9fd39f] text-primary px-4 h-11 hover:bg-primary/10">
                        <span class="material-symbols-outlined text-[20px]">add</span>
                        <span> Add another</span>
                    </button>
                </div>

                <!-- Grid fields -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Username -->
                    <label class="flex flex-col md:col-span-2">
                        <span class="text-base font-medium pb-2">Username</span>
                        <input type="text" th:field="*{username}" required
                               class="form-input w-full rounded-lg border-[#d0e7d0] dark:border-white/20 bg-background-light dark:bg-background-dark h-12 px-4 text-base placeholder:text-[#4e974e] dark:placeholder:text-white/40 focus:border-primary focus:ring-primary"/>
                        <small class="text-red-600 mt-1"
                               th:if="${#fields.hasErrors('username')}"
                               th:errors="*{username}">Username error</small>
                    </label>

                    <!-- Email -->
                    <label class="flex flex-col md:col-span-2">
                        <span class="text-base font-medium pb-2">Email</span>
                        <input type="email" th:field="*{email}" required
                               class="form-input w-full rounded-lg border-[#d0e7d0] dark:border-white/20 bg-background-light dark:bg-background-dark h-12 px-4 text-base placeholder:text-[#4e974e] dark:placeholder:text-white/40 focus:border-primary focus:ring-primary"/>
                        <small class="text-red-600 mt-1"
                               th:if="${#fields.hasErrors('email')}"
                               th:errors="*{email}">Email error</small>
                    </label>

                    <!-- Password -->
                    <label class="flex flex-col">
                        <span class="text-base font-medium pb-2">Password</span>
                        <input type="password" th:field="*{password}" required
                               class="form-input w-full rounded-lg border-[#d0e7d0] dark:border-white/20 bg-background-light dark:bg-background-dark h-12 px-4 text-base placeholder:text-[#4e974e] dark:placeholder:text-white/40 focus:border-primary focus:ring-primary"/>
                        <small class="text-red-600 mt-1"
                               th:if="${#fields.hasErrors('password')}"
                               th:errors="*{password}">Password error</small>
                    </label>

                    <!-- Street -->
                    <label class="flex flex-col">
                        <span class="text-base font-medium pb-2">Street</span>
                        <input type="text" th:field="*{street}"
                               class="form-input w-full rounded-lg border-[#d0e7d0] dark:border-white/20 bg-background-light dark:bg-background-dark h-12 px-4 text-base placeholder:text-[#4e974e] dark:placeholder:text-white/40 focus:border-primary focus:ring-primary"/>
                    </label>

                    <!-- City -->
                    <label class="flex flex-col">
                        <span class="text-base font-medium pb-2">City</span>
                        <input type="text" th:field="*{city}"
                               class="form-input w-full rounded-lg border-[#d0e7d0] dark:border-white/20 bg-background-light dark:bg-background-dark h-12 px-4 text-base placeholder:text-[#4e974e] dark:placeholder:text-white/40 focus:border-primary focus:ring-primary"/>
                    </label>

                    <!-- District -->
                    <label class="flex flex-col">
                        <span class="text-base font-medium pb-2">District</span>
                        <input type="text" th:field="*{district}"
                               class="form-input w-full rounded-lg border-[#d0e7d0] dark:border-white/20 bg-background-light dark:bg-background-dark h-12 px-4 text-base placeholder:text-[#4e974e] dark:placeholder:text-white/40 focus:border-primary focus:ring-primary"/>
                    </label>
                </div>

                <!-- Actions -->
                <div class="flex flex-col sm:flex-row items-center gap-3 pt-2">
                    <button type="submit"
                            class="inline-flex w-full sm:w-auto items-center justify-center rounded-lg h-12 px-6 bg-primary text-[#0e1b0e] text-base font-bold tracking-[0.015em] hover:bg-primary/90">
                        Register
                    </button>
                    <a class="inline-flex w-full sm:w-auto items-center justify-center rounded-lg h-12 px-6 border border-[#d0e7d0] dark:border-white/20 text-[#0e1b0e] dark:text-white hover:bg-primary/10"
                       href="/login">Have an account? Sign in</a>
                </div>
            </form>
        </div>
    </main>

    <!-- Footer -->
    <footer class="mt-auto w-full border-t border-t-[#e7f3e7] dark:border-t-white/10 py-6 px-6 md:px-10">
        <div class="max-w-7xl mx-auto flex justify-center text-center text-sm text-[#4e974e] dark:text-white/60">
            <a class="hover:underline" href="#">Terms of Service</a>
            <span class="mx-2">|</span>
            <a class="hover:underline" href="#">Privacy Policy</a>
        </div>
    </footer>
</div>

<!-- JS for adding phone fields -->
<script>
    const container = document.getElementById('phones');
    const addBtn = document.getElementById('addPhone');
    addBtn.addEventListener('click', () => {
      const idx = Number(container.dataset.nextIndex || '0');
      const row = document.createElement('div');
      row.className = 'flex items-center gap-2 mt-3';
      row.innerHTML =
        `<input name="phones[${idx}].phoneNumber" type="tel"
                placeholder="+94 7X XXX XXXX"
                class="form-input flex-1 rounded-lg border-[#d0e7d0] dark:border-white/20 bg-background-light dark:bg-background-dark h-12 px-4 text-base placeholder:text-[#4e974e] dark:placeholder:text-white/40 focus:border-primary focus:ring-primary">
         <button type="button"
                 class="px-3 h-12 rounded-lg border border-[#d0e7d0] dark:border-white/20 text-[#0e1b0e] dark:text-white hover:bg-primary/10">Remove</button>`;
      row.querySelector('button').onclick = () => row.remove();
      container.insertBefore(row, addBtn);
      container.dataset.nextIndex = String(idx + 1);
    });
</script>
</body>
</html>