<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Payments | Admin</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { primary: "#2E8B57", secondary: "#14532d" }
        }
      }
    }
  </script>
</head>
<body class="font-[Manrope] bg-[#edf5ed] text-gray-800">
<div class="flex min-h-screen">
  <!-- Sidebar -->
  <aside class="w-64 bg-white p-4 shadow-md">
    <h2 class="text-xl font-bold text-primary mb-4">Admin Panel</h2>
    <nav class="space-y-2">
      <a href="/admin/dashboard" class="block py-2 hover:text-primary">🏠 Dashboard</a>
      <a href="/admin/users" class="block py-2 hover:text-primary">👤 Users</a>
      <a href="/admin/feedbacks" class="block py-2 hover:text-primary">💬 Feedbacks</a>
      <a href="/admin/properties" class="block py-2 hover:text-primary">🏘 Properties</a>
      <a href="/admin/payments" class="block py-2 bg-primary/10 rounded font-semibold text-primary">💳 Payments</a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-8">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-3xl font-bold text-primary">All Payments</h1>
      <form method="get" class="flex gap-4 items-center">
        <select name="status" class="rounded border-gray-300 py-2 px-3" onchange="this.form.submit()">
          <option value="all" th:selected="${selectedStatus=='all'}">All Statuses</option>
          <option value="PAID" th:selected="${selectedStatus=='PAID'}">PAID</option>
          <option value="PENDING" th:selected="${selectedStatus=='PENDING'}">PENDING</option>
          <option value="OVERDUE" th:selected="${selectedStatus=='OVERDUE'}">OVERDUE</option>
        </select>
        <button class="bg-primary text-white px-4 py-2 rounded hover:bg-secondary">Filter</button>
      </form>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto bg-white rounded-xl shadow border border-gray-200">
      <table class="min-w-full text-sm">
        <thead class="bg-primary text-white text-left">
          <tr>
            <th class="px-4 py-3">#</th>
            <th class="px-4 py-3">Buyer Email</th>
            <th class="px-4 py-3">Property</th>
            <th class="px-4 py-3">Amount ($)</th>
            <th class="px-4 py-3">Method</th>
            <th class="px-4 py-3">Date</th>
            <th class="px-4 py-3">Status</th>
            <th class="px-4 py-3">Notes</th>
            <th class="px-4 py-3 text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="p,iterStat : ${payments}" class="border-b hover:bg-gray-50 transition">
            <td class="px-4 py-2" th:text="${iterStat.count}">1</td>
            <td class="px-4 py-2" th:text="${p.buyerEmail}">user@example.com</td>
            <td class="px-4 py-2" th:text="${p.property != null ? p.property.title : '—'}">Property Name</td>
            <td class="px-4 py-2" th:text="${#numbers.formatDecimal(p.amount,1,2)}">$0.00</td>
            <td class="px-4 py-2" th:text="${p.method}">Card</td>
            <td class="px-4 py-2" th:text="${p.date}">2025-10-26</td>
            <td class="px-4 py-2 font-semibold">
              <span th:text="${p.status}"
                    th:classappend="${p.status.name()=='PAID'?'text-green-600':(p.status.name()=='PENDING'?'text-yellow-600':'text-red-600')}">
                PAID
              </span>
            </td>
            <td class="px-4 py-2" th:text="${p.notes}">-</td>
            <td class="px-4 py-2 text-center">
              <div class="flex justify-center gap-3">
                <a th:href="@{'/admin/payments/edit/' + ${p.id}}"
                   class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition">Edit</a>
                <a th:href="@{'/admin/payments/delete/' + ${p.id}}"
                   onclick="return confirm('Are you sure you want to delete this payment?');"
                   class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition">Delete</a>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- No records message -->
    <div th:if="${#lists.isEmpty(payments)}"
         class="text-center py-8 text-gray-500 font-medium">
      No payments found for the selected filter.
    </div>
  </main>
</div>
</body>
</html>
